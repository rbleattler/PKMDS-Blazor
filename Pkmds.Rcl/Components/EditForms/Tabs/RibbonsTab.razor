@inherits BasePkmdsComponent

@if (Pokemon is not null &&
     AppState is
     {
         SaveFile.Context: not
         (EntityContext.None or
         EntityContext.SplitInvalid or
         EntityContext.MaxInvalid),
         SelectedSlotsAreValid: true
     })
{
    var allRibbons = GetAllRibbonInfo();
    var ribbons = allRibbons.Where(r => !IsMarkEntry(r.Name)).ToList();
    var marks = allRibbons.Where(r => IsMarkEntry(r.Name)).ToList();

    <MudStack Spacing="2"
              Class="mt-2">

        <MudStack Row>
            <MudButton OnClick="@GiveAllRibbons"
                       Variant="@Variant.Outlined"
                       Color="@Color.Primary"
                       Size="@Size.Small"
                       StartIcon="@Icons.Material.Filled.EmojiEvents">
                Give All
            </MudButton>
            <MudButton OnClick="@ClearAllRibbons"
                       Variant="@Variant.Outlined"
                       Color="@Color.Error"
                       Size="@Size.Small"
                       StartIcon="@Icons.Material.Filled.Clear">
                Clear All
            </MudButton>
        </MudStack>

        @if (ribbons.Count > 0)
        {
            <MudText Typo="@Typo.subtitle1">Ribbons</MudText>
            <div class="flex flex-wrap gap-2">
                @foreach (var ribbon in ribbons)
                {
                    @if (ribbon.Type == RibbonValueType.Boolean)
                    {
                        <MudTooltip Text="@GetRibbonDisplayName(ribbon.Name)">
                            <MudImage Src="@GetRibbonSprite(ribbon)"
                                      Width="32"
                                      Height="32"
                                      Class="@(ribbon.HasRibbon ? "cursor-pointer" : "cursor-pointer opacity-30")"
                                      @onclick="@(() => ToggleRibbon(ribbon.Name))"/>
                        </MudTooltip>
                    }
                    else
                    {
                        <MudNumericField T="int"
                                         Label="@GetRibbonDisplayName(ribbon.Name)"
                                         Min="0"
                                         Max="@ribbon.MaxCount"
                                         Value="@ribbon.RibbonCount"
                                         ValueChanged="@(v => SetRibbonCount(ribbon.Name, v))"
                                         Variant="@Variant.Outlined"
                                         Style="width: 140px"/>
                    }
                }
            </div>
        }

        @if (marks.Count > 0)
        {
            <MudText Typo="@Typo.subtitle1">Marks</MudText>
            <div class="flex flex-wrap gap-2">
                @foreach (var mark in marks)
                {
                    <MudTooltip Text="@GetRibbonDisplayName(mark.Name)">
                        <MudImage Src="@GetRibbonSprite(mark)"
                                  Width="32"
                                  Height="32"
                                  Class="@(mark.HasRibbon ? "cursor-pointer" : "cursor-pointer opacity-30")"
                                  @onclick="@(() => ToggleRibbon(mark.Name))"/>
                    </MudTooltip>
                }
            </div>
        }

    </MudStack>
}
